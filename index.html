<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Actividades</title>
  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
  <link rel="stylesheet" type="text/css" href="estilos.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1 class="title">Control de Actividades</h1>
      <button id="themeToggle" class="theme-toggle" title="Cambiar tema">
        <span class="theme-icon">‚òÄÔ∏è</span>
      </button>
    </div>

    <nav class="nav-menu">
      <button id="tabDashboard" class="nav-tab active">üìä Dashboard</button>
      <button id="tabHistory" class="nav-tab">üïí Historial</button>
    </nav>

    <div class="Contenido-Lateral">
      <div class="sidebar">
        <div class="user-card">
          <div class="avatar">
            <div class="avatar-content">
              N
              <div class="avatar-badge">‚úì</div>
            </div>
          </div>
          <div class="user-label">Reporte de Horarios</div>
          <div class="user-name interactive" id="userNameLabel" title="Click para cambiar o gestionar usuarios">
            Nicolas Godoy</div>

          <div class="time-filters">
            <button class="filter-btn active" id="Dia">D√≠a</button>
            <button class="filter-btn" id="Mes">Mes</button>
            <button class="filter-btn" id="Anio">A√±o</button>
          </div>
        </div>

        <div class="export-buttons">
          <button id="btnCreateActivity" class="export-btn"
            style="background: #ff6b35; color: white; justify-content: center; font-weight: bold;">+ Nueva
            Actividad</button>
          <div class="export-divider" style="height: 1px; background: rgba(255,255,255,0.1); margin: 10px 0;"></div>

          <button id="btnCopy" class="export-btn" style="background-color: #20e2d7; color: #1c204b; font-weight: bold;"
            title="Copia los datos para pegarlos (Ctrl+V) en Google Sheets o Excel">üìã Copiar para Excel/Sheets</button>
          <button id="btnExportExcel" class="export-btn"
            style="background-color: #43e97b; color: #1c204b; font-weight: bold; margin-top: 8px;"
            title="Descarga un archivo .xlsx con tus registros">üìä Descargar Excel (.xlsx)</button>
          <button id="btnImport" class="export-btn import">üì• Importar Datos</button>
          <input type="file" id="fileInput" accept=".json" style="display: none;">
        </div>
      </div>

      <!-- Vista Dashboard (Cartas) -->
      <main id="viewDashboard" class="vista-activa">
        <section id="sectionCards" class="Contenido-Grid-Cards">
          <!-- Las cards se inyectan aqu√≠ -->
        </section>
      </main>

      <!-- Vista Historial (Tabla) -->
      <main id="viewHistory" style="display: none;">
        <section class="history-container">
          <div class="history-controls">
            <div class="filter-group">
              <input type="date" id="historyFilterDate" class="input-hours" style="width: auto;">
              <select id="historyFilterActivity" class="input-hours" style="width: auto;">
                <option value="">Todas las actividades</option>
              </select>
            </div>
            <div class="pagination-controls">
              <button id="btnPrevPage" class="btn-timer" style="padding: 5px 15px;">&lt; Ant</button>
              <span id="pageIndicator" style="color: #aaa; font-size: 14px;">P√°g 1</span>
              <button id="btnNextPage" class="btn-timer" style="padding: 5px 15px;">Sig &gt;</button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Fecha / Hora</th>
                  <th>Actividad</th>
                  <th>Horas</th>
                  <th>Nota</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="historyTableBody">
                <!-- Datos inyectados aqu√≠ -->
              </tbody>
            </table>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal para Agregar Tiempo -->
  <div id="addTimeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Agregar Tiempo</h2>
        <span class="modal-close">&times;</span>
      </div>

      <div class="modal-body">
        <p class="modal-activity-name" id="modalActivityTitle">Actividad</p>

        <div class="form-group">
          <label for="hoursInput">Horas trabajadas:</label>
          <input type="text" id="hoursInput" placeholder="Ej: 2.5" class="input-hours">
        </div>

        <div class="form-group">
          <label for="notesInput">Notas (opcional):</label>
          <textarea id="notesInput" rows="3" placeholder="Describe lo que hiciste..." class="input-notes"></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button id="btnCancelTime" class="btn-modal btn-cancel">Cancelar</button>
        <button id="btnSaveTime" class="btn-modal btn-save">Guardar</button>
      </div>
    </div>
  </div>
  </div>

  <!-- Modal para Editar Actividad -->
  <div id="editActivityModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Editar Actividad</h2>
        <span class="modal-close-edit">&times;</span>
      </div>

      <div class="modal-body">
        <p class="modal-activity-name" id="editModalActivityTitle">Actividad</p>

        <div class="form-group">
          <label for="editHoursInput">Horas Totales (Actuales):</label>
          <input type="text" id="editHoursInput" class="input-hours">
        </div>

        <p style="font-size: 12px; color: #aaa; margin-top: 10px;">
          * Esto sobreescribir√° el total de horas para el per√≠odo seleccionado.
        </p>
      </div>

      <div class="modal-footer">
        <button id="btnCancelEdit" class="btn-modal btn-cancel">Cancelar</button>
        <button id="btnSaveEdit" class="btn-modal btn-save">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Modal para Crear Actividad -->
  <div id="createActivityModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nueva Actividad</h2>
        <span class="modal-close-create">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="newActivityName">Nombre de la Actividad:</label>
          <input type="text" id="newActivityName" class="input-hours" placeholder="Ej: Lectura">
        </div>
        <div class="form-group">
          <label>Tipo (Color):</label>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button type="button" class="color-option" data-color="trabajo"
              style="width: 30px; height: 30px; background: linear-gradient(to right, #ff5e62, #ff9966); border-radius: 50%; border: 2px solid transparent;"></button>
            <button type="button" class="color-option" data-color="juego"
              style="width: 30px; height: 30px; background: linear-gradient(to right, #56CCF2, #2F80ED); border-radius: 50%; border: 2px solid transparent;"></button>
            <button type="button" class="color-option" data-color="estudio"
              style="width: 30px; height: 30px; background: linear-gradient(to right, #ff0844, #ffb199); border-radius: 50%; border: 2px solid transparent;"></button>
            <button type="button" class="color-option" data-color="ejercicio"
              style="width: 30px; height: 30px; background: linear-gradient(to right, #43e97b, #38f9d7); border-radius: 50%; border: 2px solid transparent;"></button>
            <button type="button" class="color-option" data-color="social"
              style="width: 30px; height: 30px; background: linear-gradient(to right, #a18cd1, #fbc2eb); border-radius: 50%; border: 2px solid transparent;"></button>
            <button type="button" class="color-option" data-color="autocuidado"
              style="width: 30px; height: 30px; background: linear-gradient(to right, #f6d365, #fda085); border-radius: 50%; border: 2px solid transparent;"></button>
          </div>
          <input type="hidden" id="newActivityColor" value="trabajo">
        </div>
      </div>
      <div class="modal-footer">
        <button id="btnCancelCreate" class="btn-modal btn-cancel">Cancelar</button>
        <button id="btnSaveCreate" class="btn-modal btn-save">Crear</button>
      </div>
    </div>
  </div>

  <!-- Modal Selecci√≥n de Usuario (Privado) -->
  <div id="userSelectionModal" class="modal" style="display: none; background-color: rgba(0,0,0,0.95);">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
      <div class="modal-header" style="justify-content: center; position: relative;">
        <h2 id="userModalTitle">Ingresar Usuario</h2>
        <span id="btnCloseUserModal" class="modal-close"
          style="position: absolute; right: 20px; top: 15px;">&times;</span>
      </div>
      <div class="modal-body">
        <div id="currentUserStatus" style="display: none; margin-bottom: 20px;">
          <p style="color: #ccc; font-size: 14px;">Usuario actual: <strong id="loggedUserName"
              style="color: white;"></strong></p>
          <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button id="btnLogout" class="btn-modal"
              style="flex: 1; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
              Cerrar Sesi√≥n
            </button>
            <button id="btnDeleteAccount" class="btn-modal"
              style="flex: 1; background: rgba(255, 51, 102, 0.1); color: #ff3366; border: 1px solid rgba(255, 51, 102, 0.3);">
              Eliminar Perfil
            </button>
          </div>
          <div class="export-divider" style="height: 1px; background: rgba(255,255,255,0.1); margin: 25px 0 15px;">
          </div>
          <p style="color: #aaa; font-size: 13px;">O ingresar con otro nombre:</p>
        </div>

        <p id="userLoginDesc" style="color: #ccc; margin-bottom: 20px; font-size: 14px;">
          Ingresa tu nombre de usuario para cargar tus actividades.
        </p>

        <div
          style="background: rgba(46, 204, 113, 0.1); border-left: 3px solid #2ecc71; padding: 10px; margin-bottom: 20px; text-align: left;">
          <p style="color: #a8f0c1; font-size: 12px; margin: 0; line-height: 1.4;">
            <strong>üîí Seguridad activa:</strong> Tus perfiles est√°n vinculados a este equipo. Otros no podr√°n borrar
            tus datos desde navegadores diferentes.
          </p>
        </div>

        <div id="recentUsersSection" style="display: none; margin-bottom: 25px;">
          <p style="color: #aaa; font-size: 13px; margin-bottom: 10px;">Perfiles usados en este equipo:</p>
          <div id="recentUsersList" style="display: flex; flex-direction: column; gap: 8px;">
            <!-- Botones de usuarios locales se inyectar√°n aqu√≠ -->
          </div>
          <div class="export-divider" style="height: 1px; background: rgba(255,255,255,0.1); margin: 20px 0;"></div>
          <p style="color: #aaa; font-size: 13px;">O ingresar con uno nuevo:</p>
        </div>

        <div class="form-group">
          <input type="text" id="userInputField" class="input-hours" placeholder="Nombre de usuario"
            autocomplete="username">
          <button id="btnEnterUser" class="btn-modal btn-save"
            style="width: 100%; margin-top: 15px; height: 50px; font-size: 16px;">
            Ingresar / Crear
          </button>
        </div>

        <div id="loginStatus" style="margin-top: 10px; font-size: 13px; color: #ff6b35;"></div>
      </div>
      <div class="modal-footer" style="justify-content: center;">
        <button id="btnCancelUserModal" class="btn-modal btn-cancel" style="width: 100%;">Cerrar / Cancelar</button>
      </div>
    </div>
  </div>

  <footer class="Contenido-Footer"></footer>

  <script type="module" src="./js/app.js"></script>

</body>

</html>